# 部分还款模拟功能说明

## 🎯 功能概述

为部分还款模态框新增了"模拟还款"功能，用户可以在确认还款前预览两种不同还款策略的收益对比，帮助做出更明智的决策。

## ✨ 核心特性

### 1. 智能模拟计算
- **精确算法**: 使用等额本息公式进行精确计算
- **实时比较**: 同时计算两种策略的详细收益
- **数据验证**: 自动验证输入数据的有效性

### 2. 策略对比分析
#### 策略一：月供不变，缩短期限
- 剩余还款期限
- 节省期限（月数）
- 月还款额保持不变
- 总利息支出
- 节省利息金额

#### 策略二：期限不变，减少月供
- 剩余还款期限保持不变
- 新的月还款额
- 月供减少金额
- 总利息支出
- 节省利息金额

### 3. 智能推荐系统
- **最优推荐**: 基于利息节省量自动推荐更优策略
- **详细说明**: 提供推荐理由和具体收益差异
- **个性化建议**: 根据不同需求给出选择建议

## 🛠 技术实现

### 组件结构
```vue
<PartialPaymentModal
  v-model:visible="partialPaymentVisible"
  :current-period="currentPartialPaymentPeriod"
  :original-date="modalOriginalDate"
  :remaining-principal="modalRemainingPrincipal"
  :format-number="formatNumber"
  :loan-params="loanParams"
  @confirm="handlePartialPaymentConfirm"
/>
```

### 新增 Props
```javascript
loanParams: {
  type: Object,
  default: () => ({
    interestRate: 0, // 年利率
    loanTerm: 0, // 总期数
    originalMonthlyPayment: 0 // 原始月供
  })
}
```

### 主要方法

#### 1. 模拟计算入口
```javascript
const simulatePayment = async () => {
  // 验证输入数据
  // 计算两种策略
  // 生成对比结果
}
```

#### 2. 策略计算方法
```javascript
// 缩短期限策略
const calculateShortenTerm = (principal, monthlyRate, monthlyPayment) => {
  // 使用等额本息公式计算新期数
  // 返回期数和总利息
}

// 减少月供策略
const calculateReducePayment = (principal, monthlyRate, term) => {
  // 计算新的月供金额
  // 返回月供和总利息
}
```

#### 3. 智能推荐逻辑
```javascript
const recommendation = computed(() => {
  // 比较两种策略的利息节省量
  // 生成推荐建议和说明
})
```

## 🎨 UI/UX 设计

### 视觉层次
1. **模拟按钮**: 醒目的信息色按钮，配有计算器图标
2. **对比卡片**: 两个并排的策略卡片，支持选择和高亮
3. **数据展示**: 清晰的数值对比，关键收益突出显示
4. **推荐建议**: 智能推荐算法的结果以警告框形式展示

### 交互体验
- **渐进式披露**: 先填写基础信息，再进行模拟
- **即时反馈**: 数据变化时自动清除旧的模拟结果
- **防误操作**: 必须先模拟后才能确认还款
- **流畅动画**: 结果展示有平滑的进入动画

### 响应式适配
- **桌面端**: 两列并排显示策略对比
- **移动端**: 单列垂直堆叠，保持完整信息

## 📱 使用流程

### 1. 输入基础信息
```
填写提前还款金额 → 选择提前还款时间
```

### 2. 模拟计算
```
点击"模拟还款"按钮 → 系统计算两种策略 → 展示对比结果
```

### 3. 选择策略
```
查看推荐建议 → 选择合适的策略 → 确认还款
```

## 🔧 配置选项

### 模拟精度
- 利息计算精确到分
- 期数计算向上取整
- 数值格式化统一处理

### 验证规则
- 还款金额必须小于剩余本金
- 还款时间不能早于当前日期
- 两种策略必须同时有效

### 错误处理
- 计算异常自动降级
- 网络延迟友好提示
- 数据验证失败引导

## 💡 使用建议

### 适用场景
1. **资金充裕时**: 对比两种策略的长期收益
2. **月供压力大**: 评估减少月供的效果
3. **提前还贷计划**: 分析不同还款策略的影响

### 决策参考
- **选择策略一（缩短期限）当**:
  - 想尽快还清贷款
  - 月供压力不大
  - 追求最大利息节省

- **选择策略二（减少月供）当**:
  - 月供压力较大
  - 需要改善现金流
  - 有其他投资规划

## 🔮 扩展可能

### 功能增强
- [ ] 添加更多还款策略对比
- [ ] 支持多次部分还款模拟
- [ ] 导出模拟结果报告
- [ ] 历史模拟记录查看

### 数据分析
- [ ] 收益趋势图表
- [ ] 现金流影响分析
- [ ] 风险评估指标
- [ ] 投资机会成本计算

这个模拟功能大大提升了用户决策的科学性和便利性，让部分还款不再是盲目的选择，而是基于数据的理性决策。